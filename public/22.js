(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{GQGs:function(t,e,a){"use strict";a.r(e);function i(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var n={name:"dpp_config",metaInfo:{title:"Управление ДПП"},components:{ModelSelect:a("tBBa").ModelSelect},computed:{header:function(){return"Управление ДПП / "+this.item.name}},data:function(){var t;return i(t={item:{},fields:[{key:"fullname",label:"ФИО",sortable:!0},{key:"rolename",label:"Роль",sortable:!0},{key:"modify",label:"Управление",sortable:!1}],users:[],new_participant:{user:null,userState:null,role:null,roleState:null}},"users",[]),i(t,"roles",[]),i(t,"existed_error",!1),t},methods:{checkFormValidity:function(){var t=this.$refs.form.checkValidity();return this.new_participant.userState=t,this.new_participant.roleState=t,t},resetModal:function(){this.new_participant.user="",this.new_participant.userState=null,this.new_participant.role="",this.new_participant.roleState=null,this.existed_error=!1},handleOk:function(t){t.preventDefault(),this.handleSubmit()},handleSubmit:function(){this.checkFormValidity()&&this.store_dpp_user_role()},handleResponse:function(t){"exists"==t.data?(this.existed_error=!0,this.new_participant.roleState=null):(this.resetModal(),this.$bvModal.hide("add_participants"),this.item.participants.push(t.data))},store_dpp_user_role:function(){var t=this;axios.post("/add_dpp_user_role",{user:this.new_participant.user,role:this.new_participant.role,dpp:this.$route.params.dpp}).then((function(e){return t.handleResponse(e)}))},confirmDelete:function(t){var e=this;this.$bvModal.msgBoxConfirm("Удалить роль «"+t.rolename+"» пользователя «"+t.fullname+"»?").then((function(a){1==a&&axios.post("/delete_dpp_user_role",{id:t.id}).then((function(){return e.item.participants.splice(e.item.participants.indexOf(t),1)}))})).catch((function(t){}))}},mounted:function(){var t=this;axios.get("/dpps/"+this.$route.params.dpp+"/config").then((function(e){return t.item=e.data})),axios.get("/dpp_types").then((function(e){return t.dpp_types=e.data})),axios.get("/users").then((function(e){return t.users=e.data})),axios.get("/roles").then((function(e){return t.roles=e.data}))}},r=a("KHd+"),s=Object(r.a)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("b-card",{attrs:{title:t.header}},[a("router-link",{attrs:{icon:"ion ion-md-person",to:{name:"dpps"},exact:!0}},[a("b-button",{attrs:{variant:"info"}},[a("i",{staticClass:"ion ion-ios-arrow-back",staticStyle:{"font-size":"20px"}}),t._v(" Назад\n            ")])],1),t._v(" "),a("hr"),t._v(" "),a("h5",[t._v("Наименование (тематика) ДПП")]),t._v(" "),a("p",[t._v(t._s(t.item.name))]),t._v(" "),a("h5",[t._v("Тип ДПП")]),t._v(" "),a("p",[t._v(t._s(t.item.type_name))]),t._v(" "),a("h5",[t._v("Аннотация")]),t._v(" "),a("p",[t._v("...")]),t._v(" "),a("h5",[t._v("Участники")]),t._v(" "),a("b-table",{attrs:{bordered:"",hover:"","table-variant":"light","head-variant":"light",items:t.item.participants,fields:t.fields},scopedSlots:t._u([{key:"cell(modify)",fn:function(e){return[a("b-button",{attrs:{variant:"outline-danger"},on:{click:function(a){return t.confirmDelete(e.item)}}},[a("i",{staticClass:"ion ion-md-close",staticStyle:{"font-size":"14px"}})])]}}])}),t._v(" "),a("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.add_participants",modifiers:{add_participants:!0}}],attrs:{variant:"primary"}},[t._v("Добавить участника")])],1),t._v(" "),a("b-modal",{ref:"modal",attrs:{id:"add_participants",title:"Добавить участников","ok-title":"Добавить","cancel-title":"Закрыть"},on:{ok:t.handleOk}},[a("form",{ref:"form",on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),t.handleSubmit.apply(null,arguments)}}},[a("b-form-group",{attrs:{state:t.new_participant.userState,label:"Пользователь","label-for":"user-input","invalid-feedback":"Необходимо выбрать пользователя","label-size":"lg"}},[a("model-select",{attrs:{id:"user-input",options:t.users,state:t.new_participant.userState,placeholder:"Выберите пользователя"},model:{value:t.new_participant.user,callback:function(e){t.$set(t.new_participant,"user",e)},expression:"new_participant.user"}})],1),t._v(" "),a("b-form-group",{attrs:{state:t.new_participant.roleState,label:"Роль","label-for":"role-input","invalid-feedback":"Необходимо выбрать роль","label-size":"lg"}},[a("b-form-select",{attrs:{id:"role-input",options:t.roles,state:t.new_participant.roleState,required:""},model:{value:t.new_participant.role,callback:function(e){t.$set(t.new_participant,"role",e)},expression:"new_participant.role"}})],1)],1),t._v(" "),t.existed_error?a("b-alert",{attrs:{show:"",variant:"danger"}},[t._v("Ошибка! Пользователь уже выполняет указанную роль в данной программе.")]):t._e()],1)],1)}),[],!1,null,null,null);e.default=s.exports}}]);