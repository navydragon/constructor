(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{TL7r:function(t,e,s){"use strict";s.r(e);var n={name:"dpp_stage_work_structure",metaInfo:{title:"Разработка ДПП - Структура"},components:{},computed:{header:function(){return"Разработка ДПП / "+this.stage.dpp_name+" / "+this.stage.type_name}},data:function(){return{stage:{},sections:[],new_theme:{name:"",lection_hours:0,practice_hours:0,self_hours:0,lab_hours:0,attestation_hours:0,parent_id:"",knowledges:[]},new_section:{name:""},current_section:{themes:[]},current_theme:{knowledges:[],zuns:{knowledges:[],abilities:[],skills:[]}},zuns:{}}},methods:{rebuild:function(){var t=this;axios.post("/dpps/"+this.$route.params.dpp+"/structure/"+this.stage.st_version_id+"/rebuild").then((function(e){axios.get("/dpps/"+t.$route.params.dpp+"/structure/"+t.stage.st_version_id+"/get_sections").then((function(e){return t.sections=e.data}))}))},used_hours:function(){var t=this.sections;return t=t.reduce((function(t,e){return t+e.total_hours}),0)},create_theme:function(t,e){this.new_theme.parent_id=e,null!==t&&(this.new_theme.name=t.what.charAt(0).toUpperCase()+t.what.slice(1),this.new_theme.knowledges.push(t.id)),this.$bvModal.show("new_theme")},count_section_hours:function(t){for(var e=0,s=this.sections.find((function(e){return e.id==t})),n=this.sections.indexOf(s),r=0;r<s.themes.length;r++)e+=parseInt(s.themes[r].lection_hours),parseInt(s.themes[r].practice_hours),parseInt(s.themes[r].self_hours);s.lection_hours=e,s.practice_hours=e,s.self_hours=e,s.total_hours=s.lection_hours+s.practice_hours+s.self_hours,this.sections[n]=s},reset_new_theme:function(){this.new_theme={name:"",lection_hours:0,practice_hours:0,self_hours:0,lab_hours:0,attestation_hours:0,parent_id:"",knowledges:[]}},reset_current_section:function(){this.current_section={themes:[]}},add_section:function(){var t=this;axios.post("/dpps/"+this.$route.params.dpp+"/structure/"+this.stage.st_version_id+"/add_section",{section_data:this.new_section}).then((function(e){t.sections.push(e.data)}))},add_theme:function(){var t=this;self=this,axios.post("/dpps/"+this.$route.params.dpp+"/structure/"+this.stage.st_version_id+"/add_theme",{theme_data:this.new_theme}).then((function(e){var s=t.sections.find((function(e){return e.id==t.new_theme.parent_id}));s=t.sections.indexOf(s),t.sections[s]=e.data})).finally((function(e){t.reset_new_theme()}))},delete_theme:function(t,e){var s=this;axios.post("/dpps/"+this.$route.params.dpp+"/structure/"+this.stage.st_version_id+"/delete_theme",{id:t}).then((function(t){parent=s.sections.find((function(t){return t.id==e})),parent=s.sections.indexOf(parent),s.sections[parent]=t.data})).finally((function(t){s.reset_new_theme()}))},edit_theme:function(t){this.current_theme=t,this.current_theme.zuns={knowledges:[],abilities:[],skills:[]},this.$bvModal.show("edit_theme")},update_theme:function(){var t=this;axios.post("/dpps/"+this.$route.params.dpp+"/structure/"+this.stage.st_version_id+"/update_theme",{theme_data:this.current_theme}).then((function(e){var s=t.sections.find((function(e){return e.id==t.current_theme.parent_id}));s=t.sections.indexOf(s),t.sections[s]=e.data})).finally((function(e){t.reset_current_section()}))},edit_section:function(t){this.current_section=t,this.$bvModal.show("edit_section")},delete_section:function(t){var e=this;axios.post("/dpps/"+this.$route.params.dpp+"/structure/"+this.stage.st_version_id+"/delete_section",{id:t}).then((function(s){e.sections=e.sections.filter((function(e){return e.id!==t}))}))},update_section:function(){var t=this;axios.post("/dpps/"+this.$route.params.dpp+"/structure/"+this.stage.st_version_id+"/update_section",{section_data:this.current_section}).then((function(e){var s=t.sections.find((function(e){return e.id==t.current_section.id}));s=t.sections.indexOf(s),t.sections[s]=e.data})).finally((function(e){t.reset_new_theme()}))},move_up:function(t,e){var s=this;axios.post("/dpps/"+this.$route.params.dpp+"/structure/"+this.stage.st_version_id+"/move_up",{id:t,parent_id:e}).then((function(n){if(null==e){var r=s.sections.find((function(e){return e.id==t})),i=s.sections.indexOf(r);s.sections[i].position-=1,s.sections[i-1].position+=1,s.sections.sort((function(t,e){return parseInt(t.position)-parseInt(e.position)}))}else parent=s.sections.find((function(t){return t.id==e})),parent=s.sections.indexOf(parent),s.sections[parent]=n.data,s.reset_new_theme()}))},move_down:function(t,e){var s=this;axios.post("/dpps/"+this.$route.params.dpp+"/structure/"+this.stage.st_version_id+"/move_down",{id:t,parent_id:e}).then((function(n){if(null==e){var r=s.sections.find((function(e){return e.id==t})),i=s.sections.indexOf(r);s.sections[i].position+=1,s.sections[i+1].position-=1,s.sections.sort((function(t,e){return parseInt(t.position)-parseInt(e.position)}))}else parent=s.sections.find((function(t){return t.id==e})),parent=s.sections.indexOf(parent),s.sections[parent]=n.data,s.reset_new_theme()}))},have_practice:function(t){for(var e=!1,s=0;s<t.knowledges.length;s++)null!=t.knowledges[s].ability_id&&(e=!0);return e},go_forward:function(){var t=this;axios.post("/dpps/"+this.$route.params.dpp+"/"+this.stage.id+"/go_next").then((function(){return t.$router.push("/my_dpps/"+t.$route.params.dpp+"/overview/1")}))}},mounted:function(){var t=this,e=this;axios.get("/dpps/"+this.$route.params.dpp+"/get_stage_data/"+this.$route.params.stage).then((function(e){return t.stage=e.data})).finally((function(t){axios.get("/dpps/"+e.$route.params.dpp+"/structure/"+e.stage.st_version_id+"/get_sections").then((function(t){return e.sections=t.data})),axios.get("/dpps/"+e.$route.params.dpp+"/structure/"+e.stage.st_version_id+"/get_zuns").then((function(t){return e.zuns=t.data}))}))}},r=s("KHd+"),i=Object(r.a)(n,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("b-button",{attrs:{variant:"primary"},on:{click:function(e){return t.$router.go(-1)}}},[t._v("Назад")]),t._v(" "),s("b-card",{attrs:{title:t.header}}),t._v(" "),s("b-card",{attrs:{"no-body":""}},[s("div",[s("b-alert",{attrs:{variant:this.stage.dpp_total_hours==t.used_hours()?"success":"danger",show:""}},[t._v("Планируется часов: "),s("strong",[t._v(t._s(this.stage.dpp_total_hours))]),t._v(". Распределено часов: "+t._s(t.used_hours()))])],1),t._v(" "),s("b-tabs",{attrs:{card:""}},[s("b-tab",{attrs:{title:"Учебный план",active:""}},[s("h5",[t._v("Учебный план")]),t._v(" "),s("b-button",{on:{click:t.rebuild}},[t._v("Сбросить")]),t._v(" "),s("b-button",{attrs:{variant:"info",href:"/dpps/"+t.stage.dpp_id+"/export_ych_plan/"+t.stage.st_version_id,target:"_blank"}},[t._v("Экспорт учебного плана")]),t._v(" "),s("b-button",{attrs:{variant:"success"},on:{click:function(e){return t.go_forward()}}},[t._v("Согласовать результаты и перейти к следующему этапу")]),t._v(" "),s("table",{staticClass:"table table-bordered"},[s("thead",[s("tr",[s("th",{attrs:{rowspan:"2"}},[t._v("Наименование разделов")]),s("th",{attrs:{colspan:"6"}},[t._v("Трудоемкость, ч")]),s("th",{attrs:{rowspan:"2"}},[t._v("Планируемые результаты обучения")])]),t._v(" "),s("tr",[s("th",[t._v("Итого")]),s("th",[t._v("Лек.")]),s("th",[t._v("Пр.")]),s("th",[t._v("Лаб.")]),s("th",[t._v("Сам. раб.")]),s("th",[t._v("Атт.")])])]),t._v(" "),s("tbody",[t._l(t.sections,(function(e){return[s("tr",{key:"ps_"+e.id},[s("td",[s("p",{staticClass:"mb-1"},[s("strong",[t._v(t._s(e.position)+". "+t._s(e.name))])]),t._v(" "),s("div",[s("b-button-group",[1!=e.position?s("b-btn",{staticClass:"btn",attrs:{size:"sm",variant:"info icon-btn"},on:{click:function(s){return s.preventDefault(),t.move_up(e.id,null)}}},[s("i",{staticClass:"ion ion-md-arrow-round-up"})]):t._e(),t._v(" "),e.position!=t.sections.length?s("b-btn",{staticClass:"btn",attrs:{size:"sm",variant:"info icon-btn"},on:{click:function(s){return s.preventDefault(),t.move_down(e.id,null)}}},[s("i",{staticClass:"ion ion-md-arrow-round-down"})]):t._e(),t._v(" "),s("b-btn",{staticClass:"btn",attrs:{size:"sm",variant:"primary icon-btn"},on:{click:function(s){return s.preventDefault(),t.edit_section(e)}}},[s("i",{staticClass:"ion ion-md-create"})]),t._v(" "),e.is_blocked?t._e():s("b-btn",{staticClass:"btn",attrs:{size:"sm",variant:"danger icon-btn"},on:{click:function(s){return s.preventDefault(),t.delete_section(e.id)}}},[s("i",{staticClass:"ion ion-md-close"})]),t._v(" "),e.is_blocked?t._e():s("b-btn",{staticClass:"btn",attrs:{size:"sm",variant:"info icon-btn"},on:{click:function(s){return s.preventDefault(),t.create_theme(null,e.id)}}},[s("i",{staticClass:"ion ion-md-add"})])],1)],1)]),t._v(" "),s("td",[t._v(t._s(e.total_hours))]),t._v(" "),s("td",[t._v(t._s(e.lection_hours))]),t._v(" "),s("td",[t._v(t._s(e.practice_hours))]),t._v(" "),s("td",[t._v(t._s(e.lab_hours))]),t._v(" "),s("td",[t._v(t._s(e.self_hours))]),t._v(" "),s("td",[t._v(t._s(e.attestation_hours))]),t._v(" "),s("td")]),t._v(" "),t._l(e.themes,(function(n){return s("tr",{key:"ts_"+n.id},[s("td",[s("p",{staticClass:"mb-1"},[t._v(t._s(e.position)+"."+t._s(n.position)+" "+t._s(n.name))]),t._v(" "),s("div",[s("b-button-group",[1!=n.position?s("b-btn",{staticClass:"btn",attrs:{size:"sm",variant:"outline-info icon-btn"},on:{click:function(s){return s.preventDefault(),t.move_up(n.id,e.id)}}},[s("i",{staticClass:"ion ion-md-arrow-round-up"})]):t._e(),t._v(" "),n.position!=e.themes.length?s("b-btn",{staticClass:"btn",attrs:{size:"sm",variant:"outline-info icon-btn"},on:{click:function(s){return s.preventDefault(),t.move_down(n.id,e.id)}}},[s("i",{staticClass:"ion ion-md-arrow-round-down"})]):t._e(),t._v(" "),s("b-btn",{staticClass:"btn",attrs:{size:"sm",variant:"outline-primary icon-btn"},on:{click:function(e){return e.preventDefault(),t.edit_theme(n)}}},[s("i",{staticClass:"ion ion-md-create"})]),t._v(" "),n.is_blocked?t._e():s("b-btn",{staticClass:"btn",attrs:{size:"sm",variant:"outline-danger icon-btn"},on:{click:function(s){return s.preventDefault(),t.delete_theme(n.id,e.id)}}},[s("i",{staticClass:"ion ion-md-close"})])],1)],1)]),t._v(" "),s("td",[t._v(t._s(n.total_hours))]),t._v(" "),s("td",[t._v(t._s(n.lection_hours))]),t._v(" "),s("td",[t._v(t._s(n.practice_hours))]),t._v(" "),s("td",[t._v(t._s(n.lab_hours))]),t._v(" "),s("td",[t._v(t._s(n.self_hours))]),t._v(" "),s("td",[t._v(t._s(n.attestation_hours))]),t._v(" "),s("td",[s("p",[t._v("Знания: "),t._l(n.zuns.knowledges,(function(e){return s("span",{key:"tk_"+e.id},[t._v(t._s(e.name))])}))],2),t._v(" "),n.zuns.abilities.length>0?s("p",[t._v("Умения: "),t._l(n.zuns.abilities,(function(e){return s("span",{key:"ta_"+e.id},[t._v(t._s(e.name)+" ")])}))],2):t._e(),t._v(" "),n.zuns.skills.length>0?s("p",[t._v("Навыки: "),t._l(n.zuns.skills,(function(e){return s("span",{key:"ts_"+e.id},[t._v(t._s(e.name))])}))],2):t._e()])])}))]}))],2)]),t._v(" "),s("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.new_section",modifiers:{new_section:!0}}]},[t._v("Добавить раздел")])],1),t._v(" "),s("b-tab",{attrs:{title:"ЗУН"}},[s("h5",[t._v("Сопоставление ЗУН и Тем")]),t._v(" "),s("h5",[t._v("Навыки")]),t._v(" "),s("table",{staticClass:"table table-bordered"},[s("thead",[s("tr",[s("th",[t._v("Навык")]),s("th",[t._v("Тема")])])]),t._v(" "),s("tbody",t._l(t.zuns.skills,(function(e){return s("tr",{key:"s_"+e.id},[s("td",{attrs:{width:"50%"}},[t._v(t._s(e.name))]),t._v(" "),s("td",t._l(e.sections,(function(e){return s("div",{key:"ss_"+e.id},[t._v(t._s(e.name))])})),0)])})),0)]),t._v(" "),s("h5",[t._v("Умения")]),t._v(" "),s("table",{staticClass:"table table-bordered"},[s("thead",[s("tr",[s("th",[t._v("Умение")]),s("th",[t._v("Тема")])])]),t._v(" "),s("tbody",t._l(t.zuns.abilities,(function(e){return s("tr",{key:"a_"+e.id},[s("td",{attrs:{width:"50%"}},[t._v(t._s(e.name))]),t._v(" "),s("td",t._l(e.sections,(function(e){return s("div",{key:"as_"+e.id},[t._v(t._s(e.name))])})),0)])})),0)]),t._v(" "),s("h5",[t._v("Знания")]),t._v(" "),s("table",{staticClass:"table table-bordered"},[s("thead",[s("tr",[s("th",[t._v("Знание")]),s("th",[t._v("Тема")])])]),t._v(" "),s("tbody",t._l(t.zuns.knowledges,(function(e){return s("tr",{key:"k_"+e.id},[s("td",{attrs:{width:"50%"}},[t._v(t._s(e.name))]),t._v(" "),s("td",t._l(e.sections,(function(e){return s("div",{key:"ks_"+e.id},[t._v(t._s(e.name))])})),0)])})),0)])])],1)],1),t._v(" "),s("b-modal",{attrs:{id:"new_section","ok-title":"Добавить раздел",size:"xl","no-close-on-esc":"","no-close-on-backdrop":"","cancel-title":"Закрыть",title:"Добавить раздел"},on:{ok:t.add_section}},[s("b-form-group",{attrs:{"label-size":"lg",label:"Название раздела"}},[s("b-form-input",{model:{value:t.new_section.name,callback:function(e){t.$set(t.new_section,"name",e)},expression:"new_section.name"}})],1)],1),t._v(" "),s("b-modal",{attrs:{id:"new_theme","ok-title":"Добавить тему",size:"xl","no-close-on-esc":"","no-close-on-backdrop":"","cancel-title":"Закрыть",title:"Добавить тему"},on:{ok:t.add_theme}},[s("b-form-group",{attrs:{"label-size":"lg",label:"Название темы"}},[s("b-form-input",{model:{value:t.new_theme.name,callback:function(e){t.$set(t.new_theme,"name",e)},expression:"new_theme.name"}})],1),t._v(" "),s("b-form-group",{attrs:{"label-size":"lg",label:"Количество часов лекций"}},[s("b-form-input",{model:{value:t.new_theme.lection_hours,callback:function(e){t.$set(t.new_theme,"lection_hours",e)},expression:"new_theme.lection_hours"}})],1),t._v(" "),s("b-form-group",{attrs:{"label-size":"lg",label:"Количество часов практик"}},[s("b-form-input",{model:{value:t.new_theme.practice_hours,callback:function(e){t.$set(t.new_theme,"practice_hours",e)},expression:"new_theme.practice_hours"}})],1),t._v(" "),s("b-form-group",{attrs:{"label-size":"lg",label:"Количество часов лабораторных работ"}},[s("b-form-input",{model:{value:t.new_theme.lab_hours,callback:function(e){t.$set(t.new_theme,"lab_hours",e)},expression:"new_theme.lab_hours"}})],1),t._v(" "),s("b-form-group",{attrs:{"label-size":"lg",label:"Количество часов самостоятельной работы"}},[s("b-form-input",{model:{value:t.new_theme.self_hours,callback:function(e){t.$set(t.new_theme,"self_hours",e)},expression:"new_theme.self_hours"}})],1),t._v(" "),s("b-form-group",{attrs:{"label-size":"lg",label:"Количество часов итоговой аттестации"}},[s("b-form-input",{model:{value:t.new_theme.attestation_hours,callback:function(e){t.$set(t.new_theme,"attestation_hours",e)},expression:"new_theme.attestation_hours"}})],1),t._v(" "),s("h5",[t._v("Всего часов на тему: "+t._s(parseInt(t.new_theme.lection_hours)+parseInt(t.new_theme.practice_hours)+parseInt(t.new_theme.self_hours)+parseInt(t.new_theme.lab_hours)+parseInt(t.new_theme.attestation_hours)))])],1),t._v(" "),s("b-modal",{attrs:{id:"edit_section","ok-title":"Обновить",size:"xl","no-close-on-esc":"","no-close-on-backdrop":"","cancel-title":"Закрыть",title:"Редактирование раздела"},on:{ok:t.update_section}},[s("b-form-group",{attrs:{"label-size":"lg",label:"Название раздела"}},[s("b-form-input",{attrs:{disabled:"Итоговая аттестация"==t.current_section.name},model:{value:t.current_section.name,callback:function(e){t.$set(t.current_section,"name",e)},expression:"current_section.name"}})],1),t._v(" "),"Итоговая аттестация"!=t.current_section.name?s("div",[t.current_section.themes.length>0?s("b-alert",{attrs:{show:""}},[t._v("Данный раздел содержит темы, поэтому часы для него рассчитываются автоматически")]):t._e(),t._v(" "),s("b-form-group",{attrs:{"label-size":"lg",label:"Количество часов лекций"}},[s("b-form-input",{attrs:{disabled:t.current_section.themes.length>0},model:{value:t.current_section.lection_hours,callback:function(e){t.$set(t.current_section,"lection_hours",e)},expression:"current_section.lection_hours"}})],1),t._v(" "),s("b-form-group",{attrs:{"label-size":"lg",label:"Количество часов практик"}},[s("b-form-input",{attrs:{disabled:t.current_section.themes.length>0},model:{value:t.current_section.practice_hours,callback:function(e){t.$set(t.current_section,"practice_hours",e)},expression:"current_section.practice_hours"}})],1),t._v(" "),s("b-form-group",{attrs:{"label-size":"lg",label:"Количество часов лабораторных"}},[s("b-form-input",{attrs:{disabled:t.current_section.themes.length>0},model:{value:t.current_section.lab_hours,callback:function(e){t.$set(t.current_section,"lab_hours",e)},expression:"current_section.lab_hours"}})],1),t._v(" "),s("b-form-group",{attrs:{"label-size":"lg",label:"Количество часов самостоятельной работы"}},[s("b-form-input",{attrs:{disabled:t.current_section.themes.length>0},model:{value:t.current_section.self_hours,callback:function(e){t.$set(t.current_section,"self_hours",e)},expression:"current_section.self_hours"}})],1)],1):t._e(),t._v(" "),s("b-form-group",{attrs:{"label-size":"lg",label:"Количество часов аттестации"}},[s("b-form-input",{attrs:{disabled:t.current_section.themes.length>0},model:{value:t.current_section.attestation_hours,callback:function(e){t.$set(t.current_section,"attestation_hours",e)},expression:"current_section.attestation_hours"}})],1),t._v(" "),s("h5",[t._v("Всего часов в разделе: "+t._s(parseInt(t.current_section.total_hours)))])],1),t._v(" "),s("b-modal",{attrs:{id:"edit_theme","ok-title":"Обновить",size:"xl","no-close-on-esc":"","no-close-on-backdrop":"","cancel-title":"Закрыть",title:"Редактирование темы"},on:{ok:t.update_theme}},[t.current_theme.id?s("b-tabs",{attrs:{card:""}},[s("b-tab",{attrs:{title:"Основные параметры",active:""}},[s("b-form-group",{attrs:{"label-size":"lg",label:"Название раздела"}},[s("b-form-input",{model:{value:t.current_theme.name,callback:function(e){t.$set(t.current_theme,"name",e)},expression:"current_theme.name"}})],1),t._v(" "),s("b-form-group",{attrs:{"label-size":"lg",label:"Количество часов лекций"}},[s("b-form-input",{model:{value:t.current_theme.lection_hours,callback:function(e){t.$set(t.current_theme,"lection_hours",e)},expression:"current_theme.lection_hours"}})],1),t._v(" "),t.have_practice(t.current_theme)?t._e():s("b-alert",{attrs:{show:""}},[t._v('Знание, закрепленное за данной темой является "сквозным" и не относится к какому-либо умению. Поэтому часы на практику/лабораторные ввести невозможно.')]),t._v(" "),s("b-form-group",{attrs:{"label-size":"lg",label:"Количество часов практик"}},[s("b-form-input",{attrs:{disabled:!t.have_practice(t.current_theme)},model:{value:t.current_theme.practice_hours,callback:function(e){t.$set(t.current_theme,"practice_hours",e)},expression:"current_theme.practice_hours"}})],1),t._v(" "),s("b-form-group",{attrs:{"label-size":"lg",label:"Количество часов лабораторных"}},[s("b-form-input",{attrs:{disabled:!t.have_practice(t.current_theme)},model:{value:t.current_theme.lab_hours,callback:function(e){t.$set(t.current_theme,"lab_hours",e)},expression:"current_theme.lab_hours"}})],1),t._v(" "),s("b-form-group",{attrs:{"label-size":"lg",label:"Количество часов самостоятельной работы"}},[s("b-form-input",{model:{value:t.current_theme.self_hours,callback:function(e){t.$set(t.current_theme,"self_hours",e)},expression:"current_theme.self_hours"}})],1),t._v(" "),s("b-form-group",{attrs:{"label-size":"lg",label:"Количество часов аттестации"}},[s("b-form-input",{model:{value:t.current_theme.attestation_hours,callback:function(e){t.$set(t.current_theme,"attestation_hours",e)},expression:"current_theme.attestation_hours"}})],1),t._v(" "),s("h5",[t._v("Всего часов в теме: "+t._s(parseInt(t.current_theme.lection_hours)+parseInt(t.current_theme.practice_hours)+parseInt(t.current_theme.lab_hours)+parseInt(t.current_theme.self_hours)+parseInt(t.current_theme.attestation_hours)))])],1)],1):t._e()],1)],1)}),[],!1,null,null,null);e.default=i.exports}}]);