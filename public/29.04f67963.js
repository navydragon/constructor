(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{hv38:function(e,t,s){"use strict";s.r(t);var r={name:"new-user",metaInfo:{title:"Создать нового пользователя"},data:function(){return{new_user:{lastname:"",firstname:"",middlename:"",email:"",phone:""},lastname_state:null,firstname_state:null,middlename_state:null,reg:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,24}))$/,errors:[]}},computed:{isEmailValid:function(){return""==this.new_user.email?null:!!this.reg.test(this.new_user.email)}},methods:{handle_ok:function(e){e.preventDefault(),self=this,this.errors=[],0==this.new_user.lastname.length&&this.errors.push("Введите фамилию"),0==this.new_user.firstname.length&&this.errors.push("Введите имя"),0==this.new_user.middlename.length&&this.errors.push("Введите отчество"),0!=this.isEmailValid&&null!=this.isEmailValid||this.errors.push("Введите корректный e-mail"),0==this.errors.length&&axios.post("/users/check_email",{email:this.new_user.email}).then((function(e){e.data>0?self.errors.push("Пользователь с таким e-mail уже присутствует в системе"):self.$emit("add_user",{user_data:self.new_user})}))},formatter:function(e){return e.length>0?e[0].toUpperCase()+e.substr(1).toLowerCase():""}}},a=s("KHd+"),l={name:"users",metaInfo:{title:"Управление пользователями"},components:{NewUser:Object(a.a)(r,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.modal-adduser",modifiers:{"modal-adduser":!0}}],attrs:{variant:"primary"}},[e._v("Добавить пользователя")]),e._v(" "),s("b-modal",{attrs:{"no-close-on-esc":"","no-close-on-backdrop":"","ok-only":"",id:"modal-adduser","ok-title":"Добавить","cancel-title":"Закрыть",size:"xl",title:"Создание нового пользователя"},on:{ok:e.handle_ok}},[s("b-alert",{attrs:{variant:"info",show:""}},[e._v("Заполните параметры пользователя и нажмите кнопку «Добавить» ")]),e._v(" "),s("b-form-row",[s("b-form-group",{staticClass:"col",attrs:{"label-size":"lg","label-cols-lg":"2",label:"Фамилия *"}},[s("b-form-input",{attrs:{formatter:e.formatter,required:"",placeholder:"Введите фамилию"},model:{value:e.new_user.lastname,callback:function(t){e.$set(e.new_user,"lastname",t)},expression:"new_user.lastname"}})],1)],1),e._v(" "),s("b-form-row",[s("b-form-group",{staticClass:"col",attrs:{"label-size":"lg","label-cols-lg":"2",label:"Имя *"}},[s("b-form-input",{attrs:{formatter:e.formatter,required:"",placeholder:"Введите имя"},model:{value:e.new_user.firstname,callback:function(t){e.$set(e.new_user,"firstname",t)},expression:"new_user.firstname"}})],1)],1),e._v(" "),s("b-form-row",[s("b-form-group",{staticClass:"col",attrs:{"label-size":"lg","label-cols-lg":"2",label:"Отчество *"}},[s("b-form-input",{attrs:{state:e.middlename_state,formatter:e.formatter,required:"",placeholder:"Введите отчество"},model:{value:e.new_user.middlename,callback:function(t){e.$set(e.new_user,"middlename",t)},expression:"new_user.middlename"}})],1)],1),e._v(" "),s("b-form-row",[s("b-form-group",{staticClass:"col",attrs:{"label-size":"lg","label-cols-lg":"2",label:"E-mail *"}},[s("b-form-input",{attrs:{state:e.isEmailValid,type:"email",required:"",placeholder:"Введите E-mail"},model:{value:e.new_user.email,callback:function(t){e.$set(e.new_user,"email",t)},expression:"new_user.email"}})],1)],1),e._v(" "),s("b-form-row",[s("b-form-group",{staticClass:"col",attrs:{"label-size":"lg","label-cols-lg":"2",label:"Телефон"}},[s("b-form-input",{attrs:{required:"",placeholder:"Введите телефон (необязательно)"},model:{value:e.new_user.phone,callback:function(t){e.$set(e.new_user,"phone",t)},expression:"new_user.phone"}})],1)],1),e._v(" "),e.errors.length>0?s("b-alert",{attrs:{show:"",variant:"danger"}},[e._v("Обнаружены ошибки:\n          "),s("ul",e._l(e.errors,(function(t){return s("li",{key:t},[e._v(e._s(t))])})),0)]):e._e()],1)],1)}),[],!1,null,null,null).exports},data:function(){return{nu:0,fields:[{key:"fullname",label:"ФИО",sortable:!0},{key:"email",label:"E-mail",sortable:!0},{key:"phone",label:"Телефон",sortable:!0},{key:"registered_at",label:"Дата регистрации",sortable:!0},{key:"modify",label:"Управление",sortable:!1}],errors:[],items:[{}],info:"",isBusy:!0}},methods:{send_email:function(e,t){axios.post("/users/send_reg_data",{user_id:t})},discard_password:function(e,t){this.$bvModal.msgBoxConfirm("Сбросить пароль пользователя «"+e.fullname+"»?").then((function(e){!0===e&&axios.post("/users/discard_password",{user:t})}))},add_user:function(e){var t=this;self=this,axios.post("/users/add_user",{user_data:e}).then((function(e){alert("Пользователь зарегистрирован! Ему направлено письмо с данными для входа."),self.nu++,t.items.push(e.data)}))}},mounted:function(){var e=this;axios.get("/users").then((function(t){return e.items=t.data})).finally((function(){return e.isBusy=!1}))}},n=Object(a.a)(l,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("b-card",{attrs:{title:"Управление пользователями"}},[s("b-card-text",[e._v("\n        Ниже отображается таблица всех зарегистрированных в системе пользователей\n        ")]),e._v(" "),s("new-user",{key:e.nu,on:{add_user:e.add_user}}),e._v(" "),s("b-table",{attrs:{busy:e.isBusy,bordered:"",hover:"","table-variant":"light","head-variant":"light",items:e.items,fields:e.fields},scopedSlots:e._u([{key:"table-busy",fn:function(){return[s("div",{staticClass:"text-center text-info my-2"},[s("b-spinner",{staticClass:"align-middle"}),e._v(" "),s("strong",[e._v("Загрузка...")])],1)]},proxy:!0},{key:"cell(modify)",fn:function(t){return[s("b-button",{attrs:{variant:"outline-primary"},on:{click:function(s){return e.discard_password(t.item,t.item.id)}}},[s("i",{staticClass:"ion ion-md-key",staticStyle:{"font-size":"20px"}})])]}}])})],1)],1)}),[],!1,null,null,null);t.default=n.exports}}]);