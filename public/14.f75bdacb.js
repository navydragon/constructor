(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"0C0D":function(t,n,e){"use strict";e.r(n);var i=e("wFsb"),s=e.n(i),o=e("PSD3"),a=e.n(o),r={name:"dpp_stage_work_content_lection",metaInfo:{title:"Разработка ДПП - Контент"},components:{NsiChoose:e("xY7A").a},computed:{header:function(){return"Разработка ДПП / "+this.stage.dpp_name+" / "+this.stage.type_name}},data:function(){var t=this;return{stage:{},editor:s.a,editorData:"<p>Content of the editor.</p>",content:{},lection:{parts:[]},words:0,isBusy:!0,characters:0,new_part:{name:""},current_part:{name:"",text:"Контент..."},editorConfig:{toolbar:{items:["undo","redo","heading","alignment","|","bold","italic","strikethrough","underline","subscript","superscript","specialCharacters","removeFormat","|","bulletedList","numberedList","outdent","indent","|","imageUpload","blockQuote","insertTable","mediaEmbed","fontBackgroundColor","fontColor","highlight","horizontalLine","imageInsert","pageBreak","|","wproofreader"]},language:"ru",wordCount:{onUpdate:function(n){t.current_part.words=n.words,t.current_part.symbols=n.characters}},image:{toolbar:["imageTextAlternative","imageStyle:side","toggleImageCaption"]},wproofreader:{serviceId:"zyHAR8htx1Tutf7",srcUrl:"https://svc.webspellchecker.net/spellcheck31/wscbundle/wscbundle.js",lang:"ru_RU",theme:"gray",removeBranding:!0,localization:"ru"},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells","toggleTableCaption"]},licenseKey:""}}},methods:{check:function(){var t=this.current_part.text.match(/<figure class=\"image\".*?><\/figure>/gi);console.log(t)},add_lection_part:function(){var t=this;axios.post("/dpps/"+this.$route.params.dpp+"/content/"+this.$route.params.lection+"/add_lection_part",{part_data:this.new_part}).then((function(n){return t.lection.parts.push(n.data)})).finally((function(n){t.choose_part(t.lection.parts[t.lection.parts.length-1].id),t.new_part={name:""}}))},choose_part:function(t){var n=document.querySelectorAll(".list-group-item");[].forEach.call(n,(function(t){t.classList.remove("active")})),document.getElementById("p"+t).classList.add("active"),this.current_part=this.lection.parts.find((function(n){return n.id==t}))},update_part:function(){axios.post("/dpps/"+this.$route.params.dpp+"/content/"+this.$route.params.lection+"/update_part",{part_data:this.current_part}).then((function(t){a.a.fire("Успех!","Данные сохранены.","success")}))},move_up:function(t){var n=this;this.isBusy=!0,axios.post("/dpps/"+this.$route.params.dpp+"/content/parts/"+t+"/move_up").then((function(e){var i=n.lection.parts.find((function(n){return n.id==t})),s=n.lection.parts.indexOf(i),o=n.lection.parts.find((function(t){return parseInt(t.position)==parseInt(i.position)-1})),a=n.lection.parts.indexOf(o),r=n.lection.parts[s];n.lection.parts[s].position-=1,n.lection.parts[a].position+=1,n.lection.parts[s]=n.lection.parts[a],n.lection.parts[a]=r})).finally((function(t){n.isBusy=!1}))},move_down:function(t){var n=this;this.isBusy=!0,axios.post("/dpps/"+this.$route.params.dpp+"/content/parts/"+t+"/move_down").then((function(e){var i=n.lection.parts.find((function(n){return n.id==t})),s=n.lection.parts.indexOf(i),o=n.lection.parts.find((function(t){return parseInt(t.position)==parseInt(i.position)+1})),a=n.lection.parts.indexOf(o),r=n.lection.parts[s];n.lection.parts[s].position+=1,n.lection.parts[a].position-=1,n.lection.parts[s]=n.lection.parts[a],n.lection.parts[a]=r})).finally((function(t){n.isBusy=!1}))},delete_part:function(t){var n=this;a.a.fire({title:"Удалить раздел?",text:"Контент этого раздела также будет удален",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Удалить",cancelButtonText:"Отмена"}).then((function(e){e.isConfirmed&&axios.post("/dpps/"+n.$route.params.dpp+"/content/parts/"+t+"/remove").then((function(e){var i=n.lection.parts.find((function(n){return n.id==t})).position;n.lection.parts=n.lection.parts.filter((function(n){return n.id!=t}));for(var s=0;s<n.lection.parts.length;s++)parseInt(n.lection.parts[s].position)>parseInt(i)&&n.lection.parts[s].position--})).finally((function(t){n.choose_part(n.lection.parts[n.lection.parts.length-1].id),a.a.fire("Успех!","Раздел удален.","success")}))}))},change_nsi:function(t){this.lection.nsis=t.nsi_data}},mounted:function(){var t=this;axios.get("/dpps/"+this.$route.params.dpp+"/get_stage_data/"+this.$route.params.stage).then((function(n){return t.stage=n.data})).finally((function(n){axios.get("/dpps/"+t.$route.params.dpp+"/content/get_lection/"+t.$route.params.lection).then((function(n){t.lection=n.data})).finally((function(n){t.lection.parts.length>0&&t.choose_part(t.lection.parts[0].id),t.isBusy=!1}))}))},created:function(){}},c=e("KHd+"),l=Object(c.a)(r,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("b-button",{attrs:{variant:"primary"},on:{click:function(n){return t.$router.go(-1)}}},[t._v("Назад")]),t._v(" "),e("b-overlay",{attrs:{show:t.isBusy,rounded:"sm"}},[t.lection.parent?e("b-card",{attrs:{title:t.header}},[e("h5",[t._v("Лекция: "+t._s(t.lection.parent.position)+"."+t._s(t.lection.section.position)+" "+t._s(t.lection.name))]),t._v(" "),e("h5",[t._v("Планируемые результаты обучения:")]),t._v(" "),e("ul",t._l(t.lection.knowledges,(function(n){return e("li",{key:"kn"+n.id},[t._v(t._s(n.name))])})),0),t._v(" "),e("h5",[t._v("Трудоёмкость лекции: "+t._s(t.lection.section.total_hours)+" ак. час.")])]):t._e(),t._v(" "),e("b-card",{attrs:{"no-body":""}},[e("div",[e("b-tabs",{attrs:{"content-class":"mt-3"}},[e("b-tab",{staticClass:"m-3",attrs:{title:"Контент",active:""}},[e("b-row",[e("b-col",{attrs:{cols:"3"}},[e("h5",[t._v("Структура лекции")]),t._v(" "),0==t.lection.parts.length?e("em",[t._v("Лекция пока не содержит разделы.")]):e("b-list-group",t._l(t.lection.parts,(function(n){return e("b-list-group-item",{key:"p"+n.id,staticClass:"flex-column align-items-start pt-1 pr-1",attrs:{id:"p"+n.id,button:""},on:{click:function(e){return t.choose_part(n.id)}}},[e("div",{staticClass:"d-flex w-100 justify-content-between"},[e("h5",{staticClass:"mb-1"},[t._v("\r\n                                # "+t._s(t.lection.parent.position)+"."+t._s(t.lection.section.position)+"."+t._s(n.position)+"\r\n                                ")]),t._v(" "),e("small",[e("b-button-group",[1!=n.position?e("b-btn",{staticClass:"btn",attrs:{size:"sm",variant:"info icon-btn"},on:{click:function(e){return e.preventDefault(),t.move_up(n.id)}}},[e("i",{staticClass:"ion ion-md-arrow-round-up"})]):t._e(),t._v(" "),n.position!=t.lection.parts.length?e("b-btn",{staticClass:"btn",attrs:{size:"sm",variant:"info icon-btn"},on:{click:function(e){return e.preventDefault(),t.move_down(n.id)}}},[e("i",{staticClass:"ion ion-md-arrow-round-down"})]):t._e(),t._v(" "),e("b-btn",{staticClass:"btn",attrs:{size:"sm",variant:"danger icon-btn"},on:{click:function(e){return e.preventDefault(),t.delete_part(n.id)}}},[e("i",{staticClass:"ion ion-md-close"})])],1)],1)]),t._v(" "),e("p",{staticClass:"mb-1"},[t._v("\r\n                                    "+t._s(n.name)+"\r\n                                ")]),t._v(" "),e("small",[t._v("Слов: "+t._s(n.words)+" Символов: "+t._s(n.symbols))])])})),1),t._v(" "),e("hr"),t._v(" "),e("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal",value:"new_part",expression:"'new_part'"}],attrs:{size:"sm",variant:"primary"}},[t._v("Добавить раздел")]),t._v(" "),e("b-modal",{attrs:{"ok-title":"Добавить","cancel-title":"Отмена",id:"new_part","no-close-on-backdrop":"",title:"Добавить раздел лекции"},on:{ok:t.add_lection_part}},[e("b-form-group",{attrs:{label:"Название раздела"}},[e("b-form-input",{attrs:{trim:""},model:{value:t.new_part.name,callback:function(n){t.$set(t.new_part,"name",n)},expression:"new_part.name"}})],1)],1)],1),t._v(" "),e("b-col",{attrs:{cols:"9"}},[t.lection.parts.length>0?e("b-form-group",{attrs:{label:"Название раздела"}},[e("b-form-input",{attrs:{trim:""},model:{value:t.current_part.name,callback:function(n){t.$set(t.current_part,"name",n)},expression:"current_part.name"}})],1):t._e(),t._v(" "),t.lection.parts.length>0?e("b-form-group",{attrs:{label:"Контент раздела"}},[e("ckeditor",{attrs:{editor:t.editor,config:t.editorConfig},model:{value:t.current_part.text,callback:function(n){t.$set(t.current_part,"text",n)},expression:"current_part.text"}})],1):e("b-form-group",{attrs:{label:"Контент лекции"}},[e("ckeditor",{attrs:{editor:t.editor,config:t.editorConfig},model:{value:t.current_part.text,callback:function(n){t.$set(t.current_part,"text",n)},expression:"current_part.text"}})],1),t._v(" "),e("b-button",{attrs:{variant:"primary"},on:{click:t.update_part}},[t._v(" Сохранить")]),t._v(" "),e("b-button",{attrs:{variant:"info"},on:{click:t.check}},[t._v("Проверить")])],1)],1)],1),t._v(" "),e("b-tab",{staticClass:"m-3",attrs:{title:"Тестовые вопросы"}},t._l(t.lection.knowledges,(function(n){return e("div",{key:"kn2"+n.id},[e("ol",t._l(n.questions,(function(n){return e("li",{key:"q"+n.id},[t._v(t._s(n.text)+"\r\n                                "),e("ul",t._l(n.answers,(function(n){return e("li",{key:"a"+n.id},[t._v(t._s(n.text))])})),0)])})),0)])})),0),t._v(" "),e("b-tab",{staticClass:"m-3",attrs:{title:"Литература"}},[t.isBusy?t._e():e("nsi-choose",{attrs:{mode:"work",selected:t.lection.nsis,ish_version_id:t.stage.ish_version_id},on:{change_nsi:t.change_nsi}})],1),t._v(" "),e("b-tab",{staticClass:"m-3",attrs:{title:"МТО"}})],1)],1)])],1)],1)}),[],!1,null,null,null);n.default=l.exports},xY7A:function(t,n,e){"use strict";var i=e("WfUU"),s=e("ouQC"),o={name:"nsi-choose",props:{ish_version_id:Number,selected:Array},components:{NewNsi:i.a,EditNsi:s.a},data:function(){return{nn:"n",types:[],nsis:[],isBusy:!0,show_edit_window:!1,nsi_to_edit:0}},computed:{npas:function(){return this.nsis.filter((function(t){return 1==t.type_id}))},ychs:function(){return this.nsis.filter((function(t){return 2==t.type_id}))},irs:function(){return this.nsis.filter((function(t){return 3==t.type_id}))},ebss:function(){return this.nsis.filter((function(t){return 4==t.type_id}))}},methods:{add_nsi:function(t){var n=this,e=this;axios.post("/nsis/add_nsi",{nsi_data:t.nsi_data,ish_version_id:this.ish_version_id}).then((function(t){alert("Источник добавлен!"),e.nn++,e.nsis.push(t.data),n.$emit("add_nsi",{nsi_data:t.data})}))},update_nsi:function(t){var n=this;axios.post("/nsis/update_nsi",{nsi_data:t.nsi_data}).then((function(e){alert("Источник обновлен!"),n.nsis=n.nsis.filter((function(n){return n.id!=t.nsi_data.id})),n.nsis.push(e.data),n.$bvModal.hide("modal-editnsi")}))},remove_nsi:function(t){var n=this;this.$bvModal.msgBoxConfirm("Действительно хотите источник?").then((function(e){1==e&&axios.post("/nsis/remove_nsi",{nsi_id:t}).then((function(t){return n.nsis=n.nsis.filter((function(n){return n.id!=t.data}))}))}))},edit_nsi:function(t){var n=this;this.nsi_to_edit=t,this.show_edit_window=!0,this.$nextTick((function(){n.$bvModal.show("modal-editnsi")}))},change_nsi:function(t){this.$emit("change_nsi",{nsi_data:this.selected})}},mounted:function(){var t=this;axios.get("/nsis/nsi_types").then((function(n){return t.types=n.data})),axios.get("/nsis/"+this.ish_version_id).then((function(n){return t.nsis=n.data}))}},a=e("KHd+"),r=Object(a.a)(o,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-12"},[e("h5",[t._v("Выбрано источников ("+t._s(t.selected.length)+")")])])]),t._v(" "),t._l(t.types,(function(n){return e("div",{key:"t"+n.id,staticClass:"col-md-12"},[e("h5",[t._v(t._s(n.name)+" ("+t._s(t.nsis.filter((function(t){return t.type_id==n.id})).length)+")")]),t._v(" "),e("b-form-checkbox-group",{attrs:{options:t.nsis.filter((function(t){return t.type_id==n.id})),name:"nsis","value-field":"id","text-field":"name",stacked:""},on:{input:t.change_nsi},model:{value:t.selected,callback:function(n){t.selected=n},expression:"selected"}}),t._v(" "),e("br")],1)})),t._v(" "),e("new-nsi",{key:t.nn,attrs:{types:t.types},on:{add_nsi:t.add_nsi}}),t._v(" "),t.show_edit_window?e("edit-nsi",{key:t.nsi_to_edit,attrs:{nsi_id:t.nsi_to_edit,types:t.types},on:{update_nsi:t.update_nsi}}):t._e()],2)}),[],!1,null,null,null);n.a=r.exports}}]);