(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{"/NAf":function(t,e,i){"use strict";i.r(e);var n={name:"typologies",metaInfo:{title:"Управление типологиями содержания ДПП"},data:function(){return{t:0,fields:[{key:"name",label:"Наименование",sortable:!0},{key:"parts",label:"Разделов",sortable:!0},{key:"modify",label:"Управление",sortable:!1}],items:[],info:"",isBusy:!0,new_typology:{name:"",nameState:null,parts:[{id:this.generate_id(),name:"",state:null}]},edit_item:{}}},methods:{handleOk:function(t){t.preventDefault(),self=this,axios.post("/typologies/add_typology",this.new_typology).then((function(t){self.items.push(t.data),self.$bvModal.hide("create_typology")})).finally((function(){return self.t=self.t+1}))},handleEditOk:function(t){t.preventDefault(),self=this,axios.post("/typologies/update_typology",this.edit_item).then((function(t){self.items.find((function(e){return e.id==t.data.id}));t.data,self.$bvModal.hide("edit_modal")})).finally((function(){return self.t=self.t+1}))},remove_part:function(t){self=this,axios.post("/typologies/remove_part",t).then((function(e){self.edit_item.parts=self.edit_item.parts.filter((function(e){return e.id!=t.id}))}))},generate_id:function(){return"f".concat((~~(1e8*Math.random())).toString(16))},add_part:function(){this.new_typology.parts.push({id:this.generate_id(),name:"",state:null})},add_part_to_edit:function(){this.edit_item.parts.push({id:this.generate_id(),name:"",state:null})},edit_typology:function(t){var e=this;this.edit_item=t,this.$nextTick((function(){e.$bvModal.show("edit_modal")}))},move_up:function(t){var e=this.edit_item.parts.find((function(e){return e.id==t.id})),i=e.position-1,n=this.edit_item.parts.find((function(t){return t.position==i}));n.position=n.position+1,e.position=e.position-1,this.edit_item.parts.sort((function(t,e){return t.position-e.position}))},move_down:function(t){var e=this.edit_item.parts.find((function(e){return e.id==t.id})),i=e.position+1,n=this.edit_item.parts.find((function(t){return t.position==i}));e.position=e.position+1,n.position=n.position-1,this.edit_item.parts.sort((function(t,e){return t.position-e.position}))}},mounted:function(){var t=this;axios.get("/typologies/get_typologies").then((function(e){return t.items=e.data})).finally((function(){return t.isBusy=!1}))}},o=i("KHd+"),a=Object(o.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("b-card",{attrs:{title:"Типологии содержания ДПП"}},[i("b-card-text",[t._v("\n        Ниже отображается таблица всех типовых структур ДПП\n        ")]),t._v(" "),i("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.create_typology",modifiers:{create_typology:!0}}],attrs:{variant:"primary"}},[t._v("Создать типовую структуру")]),t._v(" "),i("p"),t._v(" "),i("hr"),t._v(" "),i("b-table",{attrs:{busy:t.isBusy,bordered:"",hover:"","table-variant":"light","head-variant":"light",items:t.items,fields:t.fields},scopedSlots:t._u([{key:"table-busy",fn:function(){return[i("div",{staticClass:"text-center text-info my-2"},[i("b-spinner",{staticClass:"align-middle"}),t._v(" "),i("strong",[t._v("Загрузка...")])],1)]},proxy:!0},{key:"cell(parts)",fn:function(e){return[t._v("\n                "+t._s(e.item.parts.length)+"\n            ")]}},{key:"cell(modify)",fn:function(e){return[i("b-button",{attrs:{variant:"outline-primary"},on:{click:function(i){return t.edit_typology(e.item)}}},[i("i",{staticClass:"ion ion-md-construct",staticStyle:{"font-size":"20px"}})])]}}])})],1),t._v(" "),i("b-modal",{key:t.t,ref:"modal",attrs:{id:"create_typology",title:"Создать типовую структуру ДПП","ok-title":"Создать",size:"lg","cancel-title":"Закрыть"},on:{ok:t.handleOk}},[i("b-form-group",{attrs:{state:t.new_typology.nameState,label:"Название","label-for":"name-input","invalid-feedback":"Необходимо ввести название","label-size":"lg"}},[i("b-form-input",{attrs:{id:"name-input",state:t.new_typology.nameState,required:""},model:{value:t.new_typology.name,callback:function(e){t.$set(t.new_typology,"name",e)},expression:"new_typology.name"}})],1),t._v(" "),i("h5",[t._v("Разделы типологии:")]),t._v(" "),i("b-button",{attrs:{variant:"primary"},on:{click:t.add_part}},[t._v("Добавить раздел")]),t._v(" "),t._l(t.new_typology.parts,(function(e,n){return i("div",{key:e.id,staticClass:"m-3"},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-md-1"},[t._v("\n                        "+t._s(n+1)+".\n                    ")]),t._v(" "),i("div",{staticClass:"col-md-11"},[i("b-form-input",{attrs:{state:e.nameState,required:""},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"elem.name"}})],1)])])}))],2),t._v(" "),i("b-modal",{key:t.edit_item.id,ref:"modal",attrs:{id:"edit_modal",title:"Редактирование типовой структуры ДПП","ok-title":"Сохранить",size:"lg","cancel-title":"Закрыть"},on:{ok:t.handleEditOk}},[i("b-form-group",{attrs:{label:"Название","invalid-feedback":"Необходимо ввести название","label-size":"lg"}},[i("b-form-input",{attrs:{required:""},model:{value:t.edit_item.name,callback:function(e){t.$set(t.edit_item,"name",e)},expression:"edit_item.name"}})],1),t._v(" "),i("h5",[t._v("Разделы типологии:")]),t._v(" "),i("b-button",{attrs:{variant:"primary"},on:{click:t.add_part_to_edit}},[t._v("Добавить раздел")]),t._v(" "),t._l(t.edit_item.parts,(function(e,n){return i("div",{key:e.id,staticClass:"m-3"},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-md-1"},[t._v("\n                        "+t._s(n+1)+".\n                    ")]),t._v(" "),i("div",{staticClass:"col-md-9"},[i("b-form-textarea",{attrs:{rows:"3","max-rows":"6",required:""},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"elem.name"}})],1),t._v(" "),i("div",{staticClass:"col-md-2"},[0!=n?i("b-btn",{staticClass:"btn",attrs:{variant:"outline-info icon-btn btn-sm"},on:{click:function(i){return t.move_up(e)}}},[i("i",{staticClass:"ion ion-md-arrow-round-up"})]):t._e(),t._v(" "),n!=t.edit_item.parts.length-1?i("b-btn",{staticClass:"btn",attrs:{variant:"outline-info icon-btn btn-sm"},on:{click:function(i){return t.move_down(e)}}},[i("i",{staticClass:"ion ion-md-arrow-round-down"})]):t._e(),t._v(" "),i("b-btn",{attrs:{variant:"outline-danger btn-sm"},on:{click:function(i){return t.remove_part(e)}}},[i("i",{staticClass:"ion ion-md-close"})])],1)])])}))],2)],1)}),[],!1,null,null,null);e.default=a.exports}}]);